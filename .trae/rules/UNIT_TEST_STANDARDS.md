# 单元测试规范 (V1.0)

## 1. 命名与位置规范

* **文件后缀**：所有测试文件必须以 `.spec.ts` 结尾（例如：`flow-executor.spec.ts`）。
* **就近原则**：**禁止**使用独立的 `tests` 文件夹。测试文件必须与被测源文件存放在同一目录下。
* *示例*：`src/domain/kernel.ts` 的测试应位于 `src/domain/kernel.spec.ts`。


* **描述语言**：`describe` 和 `it` 的描述文字必须使用**中文**，以清晰表达业务逻辑意图。

## 2. 测试结构与独立性

* **逻辑分组**：使用 `describe` 对功能模块进行分组。
* **场景定义**：使用 `it` 描述具体的行为逻辑。
* **状态清理**：每个用例必须独立。严禁跨用例共享可变状态。使用 `beforeEach` 或 `afterEach` 进行环境复位。

## 3. 模拟 (Mocking) 准则

* **外部屏蔽**：涉及网络 (Axios)、数据库 (ArangoDB/SQLite)、文件 IO 的操作必须 Mock。
* **中文化数据**：Mock 的模拟数据内容（如：姓名、文章内容、错误消息）应优先使用**中文**，以便于审计认知逻辑。
* **工具**：统一使用 Jest 内建功能。

## 4. 断言与覆盖率

* **双向覆盖**：必须包含**正常路径 (Happy Path)** 的逻辑验证和**异常路径 (Error Handling)** 的捕获验证。
* **显式断言**：严禁仅以“不报错”为标准。必须使用 `expect(...).toBe(...)` 或 `expect(...).toMatchObject(...)` 验证数据结构的准确性。